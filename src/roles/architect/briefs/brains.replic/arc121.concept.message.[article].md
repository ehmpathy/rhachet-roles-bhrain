# message

## .what

the atomic unit of conversation in a replic brain session, carrying content from a specific role (user, assistant, system, tool) with associated metadata.

## .why

messages are the building blocks of context. understanding message structure and roles is fundamental to designing effective prompts, managing context, and debugging agent behavior. each message type serves a distinct purpose in the conversation flow.

## dependsOn

- `session` — messages exist within sessions
- `context-window` — messages consume tokens

## message roles

| role | purpose | example |
|------|---------|---------|
| system | initial instructions | system prompt, tool definitions |
| user | human input | questions, commands, feedback |
| assistant | llm output | responses, tool calls, reasoning |
| tool | tool execution results | file contents, command output |

## message structure

```json
{
  "role": "assistant",
  "content": "Let me read that file for you.",
  "tool_calls": [
    {
      "id": "call_abc123",
      "type": "function",
      "function": {
        "name": "Read",
        "arguments": "{\"file_path\": \"/src/main.ts\"}"
      }
    }
  ]
}
```

## content types

| type | description |
|------|-------------|
| text | natural language content |
| tool_calls | structured action requests |
| tool_results | output from tool execution |
| images | visual input (multimodal) |
| thinking | extended reasoning (if visible) |

## message flow in agentic loop

```
[user message]
       │
       ↓
[assistant message + tool_calls]
       │
       ↓
[tool message (result)]
       │
       ↓
[assistant message (continues)]
```

## token accounting

each message consumes tokens based on:
- role tokens (small overhead)
- content tokens (varies widely)
- metadata (tool call structures)

## sources

- [Anthropic API Documentation](https://docs.anthropic.com) — message format
- [OpenAI API Documentation](https://platform.openai.com/docs) — chat completions
