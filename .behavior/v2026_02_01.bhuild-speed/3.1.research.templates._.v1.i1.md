# research: templates from rhachet-roles-bhuild

## summary

rhachet-roles-bhuild provides a template pattern for fast skill invocation that eliminates startup overhead while typescript powers the implementation under the hood.

---

## citation [1]: init.behavior.sh shell wrapper

source: https://github.com/ehmpathy/rhachet-roles-bhuild/blob/main/src/domain.roles/behaver/skills/init.behavior.sh

```bash
#!/usr/bin/env bash
######################################################################
# .what = initialize a .behavior directory for bhuild thoughtroute
# ... [documentation header]
######################################################################

set -euo pipefail

exec node -e "import('rhachet-roles-bhuild').then(m => m.cli.initBehavior())" -- "$@"
```

### key pattern

the shell wrapper:
1. invokes `exec node -e` with dynamic `import()` syntax
2. imports from the **package name** directly, not a local path
3. accesses cli functions via `m.cli.functionName()` namespace
4. passes args via `-- "$@"`

---

## citation [2]: index.ts cli namespace export

source: https://github.com/ehmpathy/rhachet-roles-bhuild/blob/main/src/index.ts

```typescript
export * from './contract/sdk';

// CLI entry points for portable skill dispatch
import { withEmojiSpaceShim } from 'emoji-space-shim';

import { bindBehavior } from './contract/cli/bind.behavior';
import { bootBehavior } from './contract/cli/boot.behavior';
import { catchDream } from './contract/cli/catch.dream';
import { decomposeBehavior } from './contract/cli/decompose.behavior';
import { giveFeedback } from './contract/cli/give.feedback';
import { initBehavior } from './contract/cli/init.behavior';
import { reviewBehavior } from './contract/cli/review.behavior';

export const cli = {
  bindBehavior: () => withEmojiSpaceShim({ logic: async () => bindBehavior() }),
  bootBehavior: () => withEmojiSpaceShim({ logic: async () => bootBehavior() }),
  catchDream: () => withEmojiSpaceShim({ logic: async () => catchDream() }),
  decomposeBehavior: () =>
    withEmojiSpaceShim({ logic: async () => decomposeBehavior() }),
  giveFeedback: () => withEmojiSpaceShim({ logic: async () => giveFeedback() }),
  initBehavior: () => withEmojiSpaceShim({ logic: async () => initBehavior() }),
  reviewBehavior: () =>
    withEmojiSpaceShim({ logic: async () => reviewBehavior() }),
};
```

### key pattern

the package exports:
1. a `cli` namespace object with all cli functions
2. each function wrapped with `withEmojiSpaceShim` for cross-platform terminal compatibility
3. cli implementations live in `src/contract/cli/*.ts`

---

## citation [3]: package.json exports

source: https://github.com/ehmpathy/rhachet-roles-bhuild/blob/main/package.json

```json
{
  "name": "rhachet-roles-bhuild",
  "main": "dist/index.js",
  "exports": {
    ".": "./dist/index.js",
    "./package.json": "./package.json"
  }
}
```

### key pattern

- single entry point via `dist/index.js`
- precompiled typescript accessible via package name import

---

## citation [4]: current review.sh in this repo (rhachet-roles-bhrain)

source: src/domain.roles/reviewer/skills/review.sh (local)

```bash
#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
exec node -e "import('$SCRIPT_DIR/review.cli.js').then(m => m.review())" -- "$@"
```

### key pattern (current - suboptimal)

- requires `$SCRIPT_DIR` resolution (filesystem operation)
- imports from local path, not package name
- no centralized cli namespace

---

## comparison

| aspect | rhachet-roles-bhuild (template) | rhachet-roles-bhrain (current) |
|--------|--------------------------------|-------------------------------|
| import path | `import('package-name')` | `import('$SCRIPT_DIR/file.js')` |
| cli organization | centralized `cli` namespace | scattered per-skill |
| path resolution | node module resolution | filesystem path resolution |
| wrapper | `withEmojiSpaceShim` | none |

---

## relation to wish

the wish states:
> "right now it seems like there's some significant issues with how long it takes for the skill to bootup"
> "rhachet-roles-bhuild has figured out how to eliminate all of that delay"

### the template pattern eliminates delay via:

1. **package-level import** - `import('rhachet-roles-bhuild')` leverages node's optimized module cache, without filesystem traversal each invocation

2. **centralized cli namespace** - all cli functions exported from single entry point means one module load, not per-skill imports

3. **precompiled distribution** - `dist/index.js` is already compiled, no tsx/ts-node overhead

4. **no script_dir resolution** - removes the `$(cd ... && pwd)` shell operation, saves subprocess spawn

### the template pattern improves maintainability via:

1. **single export point** - all cli functions discoverable in one place

2. **consistent wrapper** - `withEmojiSpaceShim` ensures cross-platform emoji output

3. **standardized invocation** - all skills follow identical `exec node -e "import('pkg').then(m => m.cli.X())"` pattern

---

## files to upgrade

per the wish, these skills in rhachet-roles-bhrain should adopt the template pattern:
- `review.sh` → use `import('rhachet-roles-bhrain').then(m => m.cli.review())`
- `reflect.sh` (if exists) → same pattern

requires:
1. add `cli` namespace export to `src/index.ts`
2. move cli logic to `src/contract/cli/*.ts`
3. simplify shell wrappers to use package imports
