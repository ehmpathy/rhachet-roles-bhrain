# vision: review --join intersect as default

## the outcome world

### before (broken)

the reviewer skill has a `--join` parameter that controls how `--diffs` and `--paths` combine:
- `union` = all files from both sources
- `intersect` = only files in both sources

**the bug:** early return logic bypasses intersect mode. when one source is empty:
```ts
if (targetFilesFromDiffs.length === 0) return targetFilesFromPaths;  // ignores intersect!
if (targetFilesFromPaths.length === 0) return targetFilesFromDiffs;  // ignores intersect!
```

**result:** `--join intersect` behaves like `--join union` when one source is empty.

### after (fixed)

intersect mode works correctly:
- `intersect` of `[]` and `[a,b]` returns `[]` (correct set intersection)
- `union` of `[]` and `[a,b]` returns `[a,b]` (correct set union)

intersect is the default mode because:
- it's the safer choice: review only what's both changed AND matches the glob
- it prevents accidental review of unchanged files
- it aligns with the common workflow: "review changes that match this pattern"

### the "aha" moment

a developer wants to review only the typescript files they changed:
```sh
review.sh --rules "rules/*.md" --diffs since-main --paths "src/**/*.ts"
```

**before:** reviews ALL `src/**/*.ts` files even if they didn't change (because diffs might be empty, which triggers the early return)

**after:** reviews only the typescript files that actually changed (correct intersect behavior)

## user experience

### primary usecase: review changed files that match a pattern

```sh
# review only changed .ts files against typescript rules
review.sh --rules "rules/ts-*.md" --diffs since-main --paths "src/**/*.ts"
```

the user expects: only files that are BOTH changed AND match the glob get reviewed.

### secondary usecase: review all files from both sources

```sh
# explicit union when you want all files from both sources
review.sh --rules "rules/*.md" --diffs since-main --paths "docs/*.md" --join union
```

### edge case: one source is empty

```sh
# no files changed on branch - intersect should return empty
review.sh --rules "rules/*.md" --diffs since-main --paths "src/**/*.ts" --join intersect
# expected: error "combined scope resolves to zero files" (correct)
# before: reviews all src/**/*.ts even though no files changed (incorrect)
```

## mental model

### how users describe it

"i want to review only the files that match BOTH conditions"

this is set intersection - the overlap in a venn diagram.

### the analogy

think of a filter chain:
1. `--diffs since-main` = "files i changed"
2. `--paths "src/**/*.ts"` = "typescript files"
3. `--join intersect` = "AND" (both conditions must be true)
4. `--join union` = "OR" (either condition is sufficient)

### terms alignment

| user term | our term |
|-----------|----------|
| "AND" / "both" | intersect |
| "OR" / "either" | union |
| "inner join" | intersect |
| "outer join" | union |

## evaluation

### how well does it solve the goals?

| goal | solved? |
|------|---------|
| fix intersect mode | yes - early returns respect join mode |
| make intersect default | yes - `join ?? 'intersect'` |
| prevent accidental broad reviews | yes - intersect is narrow by default |

### pros

- **safer defaults:** won't accidentally review unchanged files
- **predictable semantics:** intersect works like set intersection
- **explicit union:** users who want broad scope can opt-in

### cons

- **major change:** prior workflows that relied on union default may need `--join union`
- **empty result surprise:** users may hit "zero files" error more often

### edgecases and pit of success

| edgecase | behavior | pit of success |
|----------|----------|----------------|
| diffs empty, paths non-empty, intersect | returns [] → error "zero files" | clear message, user knows to check their diffs |
| diffs non-empty, paths empty, intersect | returns [] → error "zero files" | clear message, user knows to check their glob |
| diffs empty, paths non-empty, union | returns paths files | explicitly requested union, expected behavior |
| only --paths specified (no --diffs) | returns paths files | join mode doesn't apply (single source) |
| only --diffs specified (no --paths) | returns diff files | join mode doesn't apply (single source) |

## implementation summary

1. **fix the bug:** modify early returns to respect join mode
2. **change default:** `join ?? 'intersect'` instead of `join ?? 'union'`
3. **update help text:** document new default
4. **add acceptance tests:** cover intersect mode with both/single source empty scenarios
