# blueprint: init.research skill

## summary

create an `init.research` skill under the librarian role that initializes a `.research/v{isodate}.{name}/` directory with thoughtroute templates for systematic research.

**key patterns [REUSE]:**
- role definition via `Role.build()` → create `getLibrarianRole.ts`
- shell skill entrypoint → create `init.research.sh`
- cli entrypoint → create `initResearch.ts`
- domain operation → create `initResearchDir.ts`
- route bind → create `setResearchBind.ts`
- findsert template semantics → reuse from init.behavior patterns

---

## treestruct: filediffs

```
src/
├── contract/
│   └── cli/
│       ├── [~] index.ts                          # add initResearch to cli export
│       └── [+] initResearch.ts                   # cli entrypoint
│
├── domain.operations/
│   └── research/
│       └── init/
│           ├── [+] initResearchDir.ts            # main domain operation
│           ├── [+] initResearchDir.test.ts       # unit tests
│           ├── [+] initResearchDir.integration.test.ts
│           ├── [+] setResearchBind.ts            # bind branch to research
│           ├── [+] setResearchBind.test.ts
│           ├── [+] setResearchBind.integration.test.ts
│           ├── [+] getResearchBind.ts            # get bound research
│           ├── [+] getResearchBind.test.ts
│           ├── [+] delResearchBind.ts            # unbind research
│           ├── [+] delResearchBind.test.ts
│           ├── .test/
│           │   ├── [+] setup.ts                  # test fixtures
│           │   └── assets/
│           │       ├── [+] research.empty/       # fixture: no prior research
│           │       └── [+] research.bound/       # fixture: pre-bound research
│           └── templates/
│               ├── [+] 0.wish.md
│               ├── [+] 1.1.probes.aim.internal.stone
│               ├── [+] 1.2.probes.aim.external.stone
│               ├── [+] 1.3.probes.aim.blend.stone
│               ├── [+] 2.probes.emit.stone
│               ├── [+] 3.1.probes.absorb.kernels.stone
│               ├── [+] 3.2.probes.absorb.clusters.stone
│               ├── [+] 3.3.probes.absorb.gaps.stone
│               ├── [+] 4.probes.remit.stone
│               ├── [+] 5.1.briefs.curate.blueprint.stone
│               └── [+] 5.2.briefs.curate.execute.stone
│
├── domain.roles/
│   └── librarian/
│       ├── [~] .readme.[seed].md                 # update with skill info
│       ├── [+] getLibrarianRole.ts               # role definition
│       ├── briefs/
│       │   ├── [○] define.brief-name-pattern.[article].md  # retain
│       │   └── [+] knowledge -> ../../thinker/briefs/knowledge  # portable symlink
│       └── skills/
│           └── [+] init.research.sh              # shell entrypoint
│
└── index.ts                                       # [○] retain (no change needed)

blackbox/
├── [+] init.research.acceptance.test.ts          # acceptance tests
└── .test/
    ├── [+] invokeResearchSkill.ts                # skill invocation helper
    └── assets/
        └── [+] research-fixture/                  # fixture for acceptance
```

---

## treestruct: codepaths

### contract layer

```
src/contract/cli/
├── [~] index.ts
│   └── export cli.research.init = initResearch
│
└── [+] initResearch.ts
    ├── parseArgs(process.argv)
    │   ├── --name <name>        required
    │   ├── --dir <directory>    optional, defaults to cwd
    │   └── --open <editor>      optional
    ├── hasHelpFlag(process.argv) → printHelp()
    ├── validate inputs before expensive ops
    └── invoke initResearchDir({ name, dir })
```

### domain.operations layer

```
src/domain.operations/research/init/
│
├── [+] initResearchDir.ts
│   ├── input: { name: string; dir?: string }
│   ├── output: { researchDir: string; created: string[]; kept: string[] }
│   │
│   ├── compute researchDirName = `v${isodate}.${name}`
│   ├── compute researchDir = path.join(dir, '.research', researchDirName)
│   │
│   ├── [←] reuse pattern from init.behavior:
│   │   ├── mkdirSync(researchDir, { recursive: true })
│   │   ├── for each template in TEMPLATES_DIR:
│   │   │   ├── if exists(targetPath) → kept.push(name)
│   │   │   └── else → findsert template with $RESEARCH_DIR_REL substitution
│   │   └── return { created, kept }
│   │
│   └── call setResearchBind({ researchDir })
│
├── [+] setResearchBind.ts
│   ├── input: { researchDir: string }
│   ├── output: { flagPath: string }
│   │
│   ├── [←] reuse pattern from setRouteBind.ts:
│   │   ├── get current branch
│   │   ├── reject protected branches (main, master)
│   │   ├── sanitize branch name
│   │   ├── check for pre-bound flags
│   │   │   ├── same research → idempotent return
│   │   │   └── different research → BadRequestError
│   │   ├── mkdir .research/{dir}/.bind/
│   │   └── write {branchFlat}.{name}.flag
│   │
│   └── return { flagPath }
│
├── [+] getResearchBind.ts
│   ├── input: { cwd?: string }
│   ├── output: { researchDir: string; branch: string } | null
│   │
│   ├── get current branch
│   ├── sanitize branch name
│   ├── glob for `.research/**/.bind/*.${branchFlat}.*.flag`
│   └── return first match or null
│
└── [+] delResearchBind.ts
    ├── input: { researchDir: string }
    ├── output: { deleted: boolean }
    │
    ├── get current branch
    ├── find flag file for branch
    └── rm flag file if found
```

### domain.roles layer

```
src/domain.roles/librarian/
│
├── [+] getLibrarianRole.ts
│   └── [←] reuse pattern from getReviewerRole.ts:
│       └── Role.build({
│           slug: 'librarian',
│           name: 'Librarian',
│           purpose: 'curate knowledge into structured briefs',
│           readme: { uri: __dirname + '/.readme.[seed].md' },
│           traits: [],
│           skills: { dirs: [{ uri: __dirname + '/skills' }], refs: [] },
│           briefs: { dirs: [{ uri: __dirname + '/briefs' }] },
│       })
│
└── skills/
    └── [+] init.research.sh
        └── [←] reuse pattern from review.sh:
            └── exec node -e "import('rhachet-roles-bhrain/cli').then(m => m.cli.research.init())" -- "$@"
```

### symlink for librarian/briefs/knowledge

```
src/domain.roles/librarian/briefs/
└── [+] knowledge -> ../../thinker/briefs/knowledge
    └── portable relative symlink enables librarian to access thinker knowledge briefs
```

---

## templates content

### 0.wish.md

```markdown
wish =
```

### 1.1.probes.aim.internal.stone

```markdown
read the wish in $RESEARCH_DIR_REL/0.wish.md

imagine probe questions to research the topics that would enable fulfillment of that wish

gather from internalized knowledge — formulate questions from what you already know:
- atleast 21 questions we should ask
- divergent thought domains to explore (parallel fields, analogies, metaphors)
- inversions to consider (what if the opposite were true? what would fail?)

---

emit to $RESEARCH_DIR_REL/1.1.probes.aim.internal.v1.i1.md
```

### 1.2.probes.aim.external.stone

```markdown
read the wish in $RESEARCH_DIR_REL/0.wish.md
read the internal probes in $RESEARCH_DIR_REL/1.1.probes.aim.internal.v1.i1.md

websearch to discover what additional questions to ask based on external sources:
- what do experts in this domain ask?
- what are the known unknowns?
- what controversies or debates exist?
- what questions did the internal probes miss?

---

emit to $RESEARCH_DIR_REL/1.2.probes.aim.external.v1.i1.md
```

### 1.3.probes.aim.blend.stone

```markdown
read the internal probes in $RESEARCH_DIR_REL/1.1.probes.aim.internal.v1.i1.md
read the external probes in $RESEARCH_DIR_REL/1.2.probes.aim.external.v1.i1.md

blend the probes into one unified set:
- dedupe overlaps
- group by theme
- order by priority (most critical gaps first)

---

emit to $RESEARCH_DIR_REL/1.3.probes.aim.blend.v1.i1.md
```

### 2.probes.emit.stone

```markdown
read the probe questions collected in $RESEARCH_DIR_REL/1.3.probes.aim.blend.v1.i1.md

for each question, launch a parallel subagent to investigate:
- one probe subagent per one question
- recommended brain: sonnet or higher

---

## subagent instructions

each probe subagent must do a thorough investigation:
- websearch to find atleast 11 relevant sources per question
- for each source, do a deep dive:
  - full summary of the source
  - MANY direct quotes (not just one or two)
  - conclusion with takeaway relationship to the wish
- distinguish facts from opinions
- note gaps and uncertainties

this is not a shallow citation list — each probe must thoroughly investigate each citation.

each subagent emits to: $RESEARCH_DIR_REL/probe.v1/q$N.probe.research.response.v1.i1.md
- where $N is the question number assigned to that probe

---

## orchestration

emit an inventory of the dispatched probes into:
$RESEARCH_DIR_REL/2.probe.emit.v1.i1.inventory.md

as each subagent completes, update its progress & stats in the inventory file
```

### 3.1.probes.absorb.kernels.stone

```markdown
read the probe results in $RESEARCH_DIR_REL/probe.v1/

for each probe result file, launch a parallel subagent to kernelize:
- one subagent per probe file
- recommended brain: sonnet or higher

---

## subagent instructions

extract atomic knowledge units from the probe result, with labels:
- [FACT] = grounded, provable, empirically or logically verifiable knowledge
- [SUMP] = assumptions; not explicitly proven or provable
- [KHUE] = questions; defined and available to be explored
- [HYPO] = hypothesis; provable claims proposed but not yet tested
- [OPIN] = subjective declaration to consider

each kernel should:
- be atomic (one idea per kernel)
- cite the source with exact quote
- cluster by domain within the probe

each subagent emits to: $RESEARCH_DIR_REL/kernel/q$N.absorb.kernels.v1.i1.md
- where $N is the question number of the source probe

---

## orchestration

emit an inventory of dispatched kernelizers into:
$RESEARCH_DIR_REL/3.1.absorb.kernels.v1.i1.inventory.md

as each subagent completes, update its progress & stats in the inventory file
```

### 3.2.probes.absorb.clusters.stone

```markdown
read all kernel files in $RESEARCH_DIR_REL/kernel/

---

## instructions

catalogize the kernels:
- cluster by domain
- relate kernels to each other (dependencies, contradictions, reinforcements)
- blend converged kernels into representative kernels that point to each citation

index based on treestruct hierarchy for lookup:
- most abstract concepts at root
- progressively concrete toward leaves
- cross-references via [$ref(kernel-NNN)] for related kernels

note: this may be a massive inventory of knowledge kernels; do this process incrementally and evolve the treestruct if needed; every single kernel must be accounted for

note: do not pigeonhole kernels into extant clusters if they fundamentally signal a new cluster; these are valuable signals that inform us of gaps in our exploration, via symmetry or inherent questions

---

## output

emit to $RESEARCH_DIR_REL/3.2.absorb.clusters.v1.i1.md
```

### 3.3.probes.absorb.gaps.stone

```markdown
read:
- $RESEARCH_DIR_REL/probe.v1/*.probe.research.response.v1.i1.md
- $RESEARCH_DIR_REL/kernel/*.absorb.kernels.v1.i1.md
- $RESEARCH_DIR_REL/3.2.absorb.clusters.v1.i1.md

---

## instructions

surface knowledge gaps across the research:
- explicit omissions (questions asked but not answered)
- implicit omissions (questions that should have been asked)
- symmetric omissions (patterns from parallel domains not yet explored)
- contradictions (kernels in conflict with each other)
- sparse clusters (domains with few kernels relative to others)

---

## output

emit to $RESEARCH_DIR_REL/3.3.absorb.gaps.v1.i1.md
```

### 4.probes.remit.stone

```markdown
read the gaps identified in $RESEARCH_DIR_REL/3.3.absorb.gaps.v1.i1.md

---

## instructions

formulate supplemental probes to fill the gaps:
- one probe per gap
- dispatch parallel subagents to investigate (same pattern as 2.probes.emit)
- each subagent emits to $RESEARCH_DIR_REL/probe.v2/q$N.probe.research.response.v1.i1.md

---

## output

emit inventory to $RESEARCH_DIR_REL/4.remit.v1.i1.inventory.md

---

## iteration

repeat until:
- gaps are sufficiently addressed
- returns diminish on supplemental probes
```

### 5.1.briefs.curate.blueprint.stone

```markdown
read:
- $RESEARCH_DIR_REL/0.wish.md
- $RESEARCH_DIR_REL/3.2.absorb.clusters.v1.i1.md
- $RESEARCH_DIR_REL/3.3.absorb.gaps.v1.i1.md
- $RESEARCH_DIR_REL/kernel/*.absorb.kernels.v1.i1.md

---

## instructions

propose a blueprint for the knowledge course breakdown:

1. identify domains and subdomains from the cluster organization
   - each domain gets a code (e.g., `cons` for consensus, `ddd` for domain-driven-design)
   - subdomains become the hierarchical path within the domain

2. plan the tier structure for each domain:
   - {code}101 = fundamentals catalog (overview of the domain)
   - {code}201 = intermediate articles (specific concepts)
   - {code}301 = advanced articles (complex topics, edge cases)
   - {code}401 = meta/synthesis (comparisons, frameworks, decision guides)
   - {code}501 = expert/research (cutting-edge, open problems, novel contributions)

3. map kernels to briefs:
   - which kernels belong in which brief?
   - what dependencies exist between briefs? (prereqs)

4. use brief name pattern (see appendix below):
   - `{code}XXX.{subtopic}._.[doctype].{variant}.md`

---

## output

emit a full treestruct of filediffs for the proposed brief structure:

$RESEARCH_DIR_REL/5.1.briefs.curate.blueprint.v1.i1.md

example format:
```
output.briefs/
├── physics.mechanics/                                            # domain dir (preview)
│   ├── mech101.fundamentals._.[catalog].md
│   ├── mech111.newtons-laws._.[catalog].md
│   ├── mech121.energy._.[catalog].md
│   ├── mech131.momentum._.[catalog].md
│   ├── mech141.waves._.[catalog].md                             # waves is part of mechanics
│   ├── ...                                                      # many more 1xx courses
│   ├── mech201.rotational._.[catalog].md
│   ├── mech251.oscillations.[article].md
│   ├── ...                                                      # many more 2xx courses
│   ├── mech301.lagrangian._.[catalog].md
│   ├── mech351.hamiltonian.[article].md
│   ├── ...                                                      # many more 3xx courses
│   ├── mech401.classical-vs-quantum._.[article].frame.limits.md
│   └── mech501.chaos-theory.[article].md
│
├── physics.electromagnetism/                                     # domain dir (expanded)
│   ├── em101.fundamentals._.[catalog].md
│   ├── em101.fundamentals.1.charge.[article].md
│   ├── em101.fundamentals.2.fields.[article].md
│   ├── em101.fundamentals.3.force.[article].md
│   ├── ...
│   ├── em111.coulombs-law._.[catalog].md
│   ├── em111.coulombs-law.1.point-charges.[article].md
│   ├── em111.coulombs-law.2.superposition.[article].md
│   ├── em111.coulombs-law.2.superposition.[demo].two-charges.md
│   ├── ...
│   ├── em121.electric-fields._.[catalog].md
│   ├── em121.electric-fields.1.field-lines.[article].md
│   ├── em121.electric-fields.1.field-lines.[lesson].phet-sim.md
│   ├── em121.electric-fields.2.flux.[article].md
│   ├── em121.electric-fields.2.flux.[demo].gaussian-surface.md
│   ├── ...
│   ├── em131.resistors._.[catalog].md
│   ├── em131.resistors.1.ohms-law.[article].md
│   ├── em131.resistors.2.materials.[article].md
│   ├── em131.resistors.2.materials.[demo].diy-resistor.md
│   ├── ...
│   ├── em141.capacitors._.[catalog].md
│   ├── em141.capacitors.1.parallel-plates.[article].md
│   ├── em141.capacitors.1.parallel-plates.[demo].diy-capacitor.md
│   ├── em141.capacitors.2.dielectrics.[article].md
│   ├── ...
│   ├── em151.inductors._.[catalog].md
│   ├── em151.inductors.1.coils.[article].md
│   ├── em151.inductors.1.coils.[demo].diy-inductor.md
│   ├── em151.inductors.2.magnetic-energy.[article].md
│   ├── ...
│   ├── em161.generators._.[catalog].md
│   ├── em161.generators.1.batteries.[article].md
│   ├── em161.generators.1.batteries.[demo].lemon-battery.md
│   ├── em161.generators.2.dynamos.[article].md
│   ├── em161.generators.2.dynamos.[demo].diy-hand-crank.md
│   ├── em161.generators.3.solar-cells.[article].md
│   ├── em161.generators.3.solar-cells.[demo].measure-solar-iv.md
│   ├── em161.generators.4.thermocouples.[article].md
│   ├── ...
│   ├── em201.maxwells-equations._.[catalog].md
│   ├── em201.maxwells-equations.1.gauss-law.[article].md
│   ├── em201.maxwells-equations.1.gauss-law.[lesson].spherical-symmetry.md
│   ├── em201.maxwells-equations.2.faraday-law.[article].md
│   ├── em201.maxwells-equations.2.faraday-law.[demo].induced-emf.md
│   ├── em201.maxwells-equations.3.ampere-law.[article].md
│   ├── ...
│   ├── em251.electromagnetic-waves.[article].md
│   ├── ...
│   ├── em301.radiation._.[catalog].md
│   ├── em301.radiation.1.dipole.[article].md
│   ├── em301.radiation.1.dipole.[demo].hertzian-dipole.md
│   ├── em301.radiation.2.antenna.[article].md
│   ├── em301.radiation.2.antenna.[lesson].nec-software.md
│   ├── ...
│   ├── em351.waveguides.[article].md
│   ├── em351.waveguides.[lesson].rectangular-mode-calc.md
│   ├── ...
│   ├── em401.unification._.[article].frame.historical.md
│   ├── ...
│   └── em501.quantum-electrodynamics.[article].md
│
├── physics.optics/                                               # domain dir (preview)
│   ├── opt101.fundamentals._.[catalog].md
│   ├── opt111.reflection._.[catalog].md
│   ├── opt121.refraction._.[catalog].md
│   ├── ...                                                      # many more 1xx courses
│   ├── opt201.wave-optics._.[catalog].md
│   ├── opt251.fiber-optics.[article].md
│   ├── ...                                                      # many more 2xx courses
│   ├── opt301.lasers._.[catalog].md
│   ├── opt351.holography.[article].md
│   ├── ...                                                      # many more 3xx courses
│   ├── opt401.geometric-vs-wave._.[article].frame.when-to-use.md
│   └── opt501.quantum-optics.[article].md
│
└── physics.thermodynamics/                                       # domain dir (preview)
    ├── thermo101.fundamentals._.[catalog].md
    ├── thermo111.laws._.[catalog].md
    ├── thermo121.entropy._.[catalog].md
    ├── thermo131.phase-change._.[catalog].md                    # boil, melt, etc.
    ├── ...                                                      # many more 1xx courses
    ├── thermo201.cycles._.[catalog].md
    ├── thermo251.phase-transitions.[article].md
    ├── ...                                                      # many more 2xx courses
    ├── thermo301.statistical-mechanics._.[catalog].md
    ├── thermo351.non-equilibrium.[article].md
    ├── ...                                                      # many more 3xx courses
    ├── thermo401.macro-vs-micro._.[article].frame.bridges.md
    └── thermo501.black-hole-thermodynamics.[article].md
```

note:
- `_` = category overview that summarizes children with that prefix
- subtopics without `_` = standalone documents (most briefs)
- numbers: 101, 110, 121, 201, 251, 301, 351, 401, 501, etc.

include:
- full list of proposed briefs with their kernel assignments
- dependency/prereq relationships between briefs
- rationale for domain/subdomain breakdown

---

## appendix: brief name pattern

briefs follow a course-code pattern inspired by university course catalogs:

```
{code}XXX.{subtopic}._.[doctype].{variant}.md
```

| component | description | examples |
|-----------|-------------|----------|
| `{code}` | topic-specific prefix (like college course codes) | `kno`, `cons`, `scm`, `ddd` |
| `XXX` | tier within topic | `101`=fundamentals, `201`=intermediate, `301`=advanced, `401`=meta, `501`=expert |
| `{subtopic}` | hierarchical path within tier | `paxos`, `raft`, `comparison` |
| `_` | category overview marker | `cons101.fundamentals._.[catalog].md` |
| `[doctype]` | document type in brackets | `[article]`, `[catalog]`, `[demo]`, `[lesson]` |
| `{variant}` | optional frame/perspective | `frame.practical_tradeoffs`, `persp.garden` |

### tiers

| tier | purpose | example |
|------|---------|---------|
| `1xx` | fundamentals | `em101.fundamentals._.[catalog].md`, `em111.coulombs-law.1.point-charges.[article].md` |
| `2xx` | intermediate | `em201.maxwells-equations.1.gauss-law.[article].md`, `em251.electromagnetic-waves.[article].md` |
| `3xx` | advanced | `em301.radiation.1.dipole.[article].md`, `em351.waveguides.[article].md` |
| `4xx` | meta/synthesis | `em401.unification._.[article].frame.historical.md` |
| `5xx` | expert/research | `em501.quantum-electrodynamics.[article].md` |

### doctypes

| doctype | purpose |
|---------|---------|
| `[article]` | deep-dive on a single concept |
| `[catalog]` | index/overview of related concepts |
| `[demo]` | worked example or demonstration |
| `[lesson]` | how-to or tutorial |

### examples

| file | explains |
|------|----------|
| `em101.fundamentals._.[catalog].md` | overview catalog of fundamentals children |
| `em101.fundamentals.1.charge.[article].md` | subdocument under fundamentals |
| `em111.coulombs-law.2.superposition.[article].md` | another 1xx topic with subtopic index |
| `em111.coulombs-law.2.superposition.[demo].two-charges.md` | worked example for superposition |
| `em121.electric-fields.1.field-lines.[lesson].phet-sim.md` | how-to with phet simulator tool |
| `em131.capacitance.1.parallel-plates.[demo].diy-capacitor.md` | build your own capacitor at home |
| `em251.electromagnetic-waves.[article].md` | standalone intermediate article (no `_`) |
| `em301.radiation._.[catalog].md` | advanced overview of radiation children |
| `em301.radiation.2.antenna.[lesson].nec-software.md` | how-to with nec antenna software |
| `em401.unification._.[article].frame.historical.md` | meta synthesis with historical frame |
| `em501.quantum-electrodynamics.[article].md` | research frontier topic |
```

### 5.2.briefs.curate.execute.stone

```markdown
read:
- $RESEARCH_DIR_REL/5.1.briefs.curate.blueprint.v1.i1.md
- $RESEARCH_DIR_REL/kernel/*.absorb.kernels.v1.i1.md
- $RESEARCH_DIR_REL/probe.v1/*.probe.research.response.v1.i1.md
- $RESEARCH_DIR_REL/probe.v2/*.probe.research.response.v1.i1.md (if present)

---

## instructions

execute the blueprint and produce the knowledge collection:

for each brief in the blueprint:
1. gather the assigned kernels
2. trace kernels back to probe sources for citations
3. compose the brief content per the format below
4. write to the specified path under output.briefs/

---

## brief format

each brief should:
- match the established brief patterns in librarian/briefs/
- include citations from probe findings (with exact quotes where applicable)
- be self-contained and reusable
- declare prerequisites if the brief depends on grasp of other briefs

structure:
```markdown
# {title}

## .what
[brief summary of what this brief covers]

## .why
[why this knowledge matters, when you would use it]

## content
[main content organized by subtopic]

## citations
[numbered list of sources with exact quotes]

## see also
[links to related briefs, prereqs]
```

---

## output

emit to $RESEARCH_DIR_REL/output.briefs/{domain}/

create all directories as needed.

emit a completion inventory to:
$RESEARCH_DIR_REL/5.2.briefs.curate.execute.v1.i1.inventory.md
```

---

## test coverage plan

### unit tests (`.test.ts`)

| file | coverage |
|------|----------|
| `initResearchDir.test.ts` | template file enumeration, findsert logic, variable substitution |
| `setResearchBind.test.ts` | branch validation, flag file format, idempotency |
| `getResearchBind.test.ts` | glob patterns, null return cases |
| `delResearchBind.test.ts` | flag file deletion |

### integration tests (`.integration.test.ts`)

| file | coverage |
|------|----------|
| `initResearchDir.integration.test.ts` | filesystem operations, directory creation, template write |
| `setResearchBind.integration.test.ts` | git branch detection, flag file write, conflict detection |

### acceptance tests (`.acceptance.test.ts`)

| file | coverage |
|------|----------|
| `init.research.acceptance.test.ts` | full skill invocation via shell entrypoint |

acceptance test structure:
```ts
given('[case1] empty directory', () => {
  when('[t0] init.research --name consensus-algorithms', () => {
    then('.research/v{date}.consensus-algorithms/ is created');
    then('0.wish.md template is present');
    then('1.probes.aim.stone template is present');
    then('.bind/{user}.consensus-algorithms.flag is present');
  });
});

given('[case2] research already bound', () => {
  when('[t0] init.research with same name', () => {
    then('returns idempotently without error');
  });
  when('[t1] init.research with different name', () => {
    then('returns error about pre-bound research');
  });
});
```

---

## domain decomposition

### domain.objects (reuse)

no new domain objects required. reuse:
- git branch name patterns from `sanitizeBranchName`
- file path patterns from prior route operations

### domain.operations (create)

| operation | responsibility |
|-----------|----------------|
| `initResearchDir` | create research directory, findsert templates |
| `setResearchBind` | bind branch to research via flag file |
| `getResearchBind` | find bound research for current branch |
| `delResearchBind` | unbind research from branch |

### access layer (reuse)

reuse prior:
- `fs` for filesystem operations
- `child_process.execSync` for git commands
- `enumFilesFromGlob` for file discovery

---

## cli contract

```
npx rhachet run --repo bhrain --role librarian --skill init.research --name <name> [--dir <path>] [--open <editor>]

options:
  --name <name>     research topic slug (required)
  --dir <path>      target directory (default: cwd)
  --open <editor>   open wish file in editor after init
  --help            show help
```

---

## dependencies

### internal
- `@src/domain.operations/review/sanitizeBranchName` — branch name sanitation
- `@src/utils/enumFilesFromGlob` — file glob utility

### external
- `helpful-errors` — BadRequestError for validation failures
- `fs/promises` — async filesystem operations
- `path` — path manipulation

---

## open questions

1. **symlink portability** — will `../../librarian/briefs` resolve correctly after `rhachet roles link`?
   - mitigation: test with actual symlink resolution in acceptance tests

2. **isodate format** — should use YYYY_MM_DD or YYYYMMDD?
   - recommendation: use `YYYY_MM_DD` for readability, matches `.behavior/` convention

3. **probe number format** — should probe numbers be zero-padded (001) or not (1)?
   - recommendation: zero-pad to 3 digits for sort order

---

## citations

| # | source | description |
|---|--------|-------------|
| 1 | `src/domain.operations/route/bind/setRouteBind.ts` | bind pattern reference |
| 2 | `src/contract/cli/index.ts` | cli export structure |
| 3 | `.behavior/v2026_02_09.init-research/3.1.research.templates._.v1.i1.md` | template patterns |
| 4 | `.behavior/v2026_02_09.init-research/3.1.research.patterns._.code.prod.v1.i1.md` | prod code patterns |
| 5 | `.behavior/v2026_02_09.init-research/3.1.research.patterns._.code.test.v1.i1.md` | test code patterns |
