# research: oss levers for drive-spinners

## requirements recap

1. tree-structured output with box-draw characters (â”œâ”€, â””â”€, â”‚)
2. animated spinners (braille patterns like â ¹)
3. in-place terminal updates (overwrite 10-20 lines)
4. elapsed time counters that tick up
5. stderr for live progress, stdout for final emit
6. multi-line re-render of the guard tree

---

## lever.1: listr2 (all-in-one task tree renderer)

| metric | value |
|--------|-------|
| npm weekly downloads | ~25.5M [1] |
| github stars | ~632 [1] |
| last publish | ~3 months ago [1] |
| notable users | angular cli, lint-staged, cypress, electron forge, graphql codegen, redwoodjs [2] |

**what it does**: declarative task runner with built-in tree renderer, spinners, elapsed timers, subtask nests, and multi-line in-place updates.

**key features**:
- tree render with box-draw characters via DefaultRenderer [2]
- `PRESET_TIMER` for elapsed time per task [2]
- subtask nest at unlimited depth [2]
- hijacks process.stdout and process.stderr for clean multi-line re-render [3]

**pros**:
- checks nearly every requirement box: tree, spinners, timers, multi-line, in-place
- massive adoption, actively maintained, typescript-first
- configurable renderers (DefaultRenderer, SimpleRenderer, custom)

**cons**:
- declarative api: tasks defined up front as `{ title, task }` arrays â€” may not fit dynamic/streamed tree updates
- DefaultRenderer hijacks stdout/stderr globally â€” could conflict with final stdout emit
- heavyweight dependency chain for what is fundamentally string render
- multi-line output within a single task (not subtasks) is limited [4]

**verdict**: strong candidate if the declarative api fits. the stdout/stderr hijack is a concern for our dual-output requirement.

---

## lever.2: log-update + cli-spinners (composable primitives)

### log-update

| metric | value |
|--------|-------|
| npm weekly downloads | ~17.3M [5] |
| github stars | ~1.1K [5] |
| last publish | ~3 months ago [5] |
| notable users | used internally by ora and listr [5] |

**what it does**: overwrites previously logged multi-line output via ansi cursor movement. the core primitive behind most terminal progress tools.

**key features**:
- `logUpdateStderr` named export â€” first-class stderr support [5]
- `logUpdate.done()` to persist output and start a new session below [5]
- partial redraws to reduce flicker [5]
- tracks line count, moves cursor up, clears, rewrites [5]

### cli-spinners

| metric | value |
|--------|-------|
| npm weekly downloads | ~36M [6] |
| github stars | ~2,687 [6] |
| last publish | ~3 weeks ago [6] |

**what it does**: data-only library â€” json of spinner frame arrays with recommended intervals. includes braille spinners (`dots`, `dots2`, ... `dots12`), arrows, lines, and dozens more [6].

### composed approach

use `log-update` (stderr mode) for multi-line in-place render. use `cli-spinners` for braille frame data. hand-roll tree render with box-draw characters (~50 lines). hand-roll elapsed timer via `Date.now()`.

**pros**:
- maximum control â€” we own the exact tree format from the vision doc
- clean stderr/stdout split: `logUpdateStderr` for live, `console.log` for final
- minimal deps â€” two small, well-maintained sindresorhus packages
- no framework lock-in, no stdout/stderr hijack
- each piece is independently replaceable

**cons**:
- more code to write: tree renderer, animation loop, elapsed formatter, state management
- we own the render loop and frame timer
- no elapsed timer built in (trivial to add)

**verdict**: strongest candidate for our specific needs. full control over tree format, clean stderr/stdout separation, minimal deps.

---

## lever.3: ora (single-line spinner)

| metric | value |
|--------|-------|
| npm weekly downloads | ~45.7M [7] |
| github stars | ~9,564 [7] |
| last publish | ~2 weeks ago [7] |
| notable users | shadcn/ui cli [8] |

**what it does**: single-line animated spinner with success/fail/warn/info states.

**key features**:
- stderr by default via `stream` option [7]
- rich customization (colors, prefix/suffix, states)
- `.frame()` method returns current spinner string for composition with log-update [9]

**cons**:
- **single-line only** â€” explicitly documented: "don't run multiple spinners concurrently" [9]
- no tree render, no elapsed timer, no multi-line
- would need log-update composition anyway, at which point ora adds little over raw cli-spinners

**verdict**: not sufficient alone. the `.frame()` method is useful if composed with log-update, but cli-spinners data achieves the same with less weight.

---

## lever.4: ink (react-based terminal renderer)

| metric | value |
|--------|-------|
| npm weekly downloads | ~2.15M (ink core) [10] |
| github stars | ~33K (ink core) [10] |
| notable users | claude code (anthropic), gemini cli (google), cloudflare wrangler, gatsby, prisma, shopify, terraform, yarn [10] |

**what it does**: full react renderer for terminals. build cli UIs with jsx components, yoga-based layout engine.

**key features**:
- `@inkjs/ui` provides Spinner, ProgressBar, StatusMessage components [11]
- full multi-line re-render natively
- stderr support via `stderr` prop [10]
- component composition for any tree structure

**cons**:
- **massive dependency**: requires react, yoga, entire ink framework
- completely different program model from the rest of the codebase
- overkill for a progress tree that renders to a string
- `@inkjs/ui` is 2 years stale (though ink core is active)

**verdict**: overkill. introduces react as a runtime dependency for what is fundamentally string generation. strong tool for complex interactive CLIs, not for a progress tree.

---

## lever.5: archy (tree string generation)

| metric | value |
|--------|-------|
| npm weekly downloads | ~4.8M [12] |
| last publish | 11 years ago (archived since 2022) [12] |

**what it does**: takes `{ label, nodes }` objects and renders them as unicode tree strings (â”‚, â”œâ”€â”€, â””â”€â”€) in `npm ls` style [12].

**key features**:
- pure string output â€” returns a string, does not touch terminal [12]
- zero dependencies
- simple api: `archy({ label: 'root', nodes: [...] })`

**cons**:
- archived, unmaintained, pre-esm, pre-typescript
- no animation, no spinners, no colors
- tree render logic is simple enough to implement in ~50 lines

**verdict**: demonstrates the pattern but not worth the dependency. the tree render is trivial to hand-roll with exact control over our format.

---

## lever.6: ansi-escapes (low-level cursor control)

| metric | value |
|--------|-------|
| npm weekly downloads | tens of millions [13] |
| github stars | ~527 [13] |
| last publish | ~3 months ago [13] |

**what it does**: pure escape code strings for cursor movement, line erasure, cursor visibility, scroll [13].

**key features**:
- `cursorUp(n)`, `eraseLines(n)`, `cursorHide`, `cursorShow` [13]
- stream agnostic â€” just returns strings, write to any stream
- used internally by log-update, ora, and many other tools [13]

**verdict**: useful as a primitive if we skip log-update. log-update wraps these patterns with line count and partial redraw logic, which saves effort.

---

## lever.7: nanospinner / yocto-spinner (lightweight single-line)

| library | downloads/wk | stars | last publish |
|---------|-------------|-------|-------------|
| nanospinner | ~354K-901K [14] | ~212 [14] | ~1 year ago |
| yocto-spinner | ~443K [15] | â€” | ~7 months ago |

both are lightweight single-line spinners with stderr defaults. same limitations as ora (single-line only) with fewer features. not suitable as primary solutions.

---

## comparison matrix

| requirement | listr2 | log-update + cli-spinners | ora | ink | hand-roll |
|---|---|---|---|---|---|
| tree with box-draw chars | âœ… built-in | ğŸ”§ hand-roll ~50 lines | âŒ | ğŸ”§ components | ğŸ”§ ~50 lines |
| animated spinners (braille) | âœ… built-in | âœ… cli-spinners data | âœ… | âœ… | ğŸ”§ + cli-spinners |
| in-place multi-line updates | âœ… built-in | âœ… log-update | âŒ single-line | âœ… | ğŸ”§ + ansi-escapes |
| elapsed time counters | âœ… PRESET_TIMER | ğŸ”§ Date.now() | âŒ | ğŸ”§ | ğŸ”§ Date.now() |
| stderr live / stdout final | âš ï¸ hijacks both | âœ… logUpdateStderr | âœ… stderr default | âœ… | âœ… |
| control over exact format | âš ï¸ renderer api | âœ… full control | âŒ | âœ… | âœ… |
| dependency weight | heavy | light (2 pkgs) | medium (1 pkg) | very heavy | zero |

---

## recommendation

### primary: log-update + cli-spinners (lever.2)

**why**:
- **exact format control**: our vision doc defines a precise tree format â€” composable primitives let us render exactly that
- **clean stderr/stdout split**: `logUpdateStderr` for live tree, `console.log` for final emit â€” no hijack
- **minimal deps**: two small, actively maintained packages from sindresorhus
- **no framework lock-in**: simple string generation + terminal overwrite
- **the tree render is trivial**: ~50 lines of recursive box-draw â€” not worth a dependency

**what we'd build**:
1. `formatGuardTree(state)` â€” pure function, returns multi-line string with box-draw chars
2. animation loop â€” `setInterval` at ~80ms, calls `logUpdateStderr(formatGuardTree(state))`
3. elapsed timer â€” `Date.now() - startTime` formatted as seconds
4. state management â€” update state as reviews/judges start, finish, or hit cache
5. final emit â€” `logUpdateStderr.done()` to persist, then `console.log(formatGuardTree(finalState))`

### fallback: listr2 (lever.1)

if the hand-roll approach proves too complex (unlikely for this scope), listr2 provides all features built-in. the risk is its declarative api and stdout/stderr hijack.

---

## citations

1. [listr2 on npmtrends](https://npmtrends.com/listr2) â€” download counts, stars
2. [listr2 docs](https://listr2.kilic.dev/) â€” features, notable users, renderers
3. [listr2 process output docs](https://listr2.kilic.dev/renderer/process-output.html) â€” stdout/stderr hijack
4. [listr2 issue #686](https://github.com/listr2/listr2/issues/686) â€” multi-line output limitations
5. [log-update readme](https://github.com/sindresorhus/log-update) â€” features, stderr support, internal usage
6. [cli-spinners on github](https://github.com/sindresorhus/cli-spinners) â€” spinner data, downloads
7. [ora on github](https://github.com/sindresorhus/ora) â€” features, stderr default, downloads
8. [ora usage in shadcn/ui](https://dev.to/ramunarasinga/find-out-how-the-ora-package-is-used-to-show-a-cli-spinner-in-shadcn-uiui-source-code-4562) â€” notable users
9. [ora issue #31](https://github.com/sindresorhus/ora/issues/31) â€” single-line limitation, .frame() workaround
10. [ink on github](https://github.com/vadimdemedes/ink) â€” features, notable users, stderr support
11. [@inkjs/ui on npm](https://www.npmjs.com/package/@inkjs/ui) â€” component library
12. [archy on npm](https://www.npmjs.com/package/archy) â€” tree render, api
13. [ansi-escapes on github](https://github.com/sindresorhus/ansi-escapes) â€” cursor control api
14. [nanospinner on github](https://github.com/usmanyunusov/nanospinner) â€” features, stderr default
15. [yocto-spinner on github](https://github.com/sindresorhus/yocto-spinner) â€” features, stderr default
