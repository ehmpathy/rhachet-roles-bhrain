# roadmap: fast skill invocation via package-level cli exports

## overview

this roadmap executes the blueprint in `.behavior/v2026_02_01.bhuild-speed/3.3.blueprint.v1.i1.md`

---

## phase 0: preparation

### prereqs
- [ ] read `.behavior/v2026_02_01.bhuild-speed/3.1.research.templates._.v1.i1.md`
- [ ] read `.behavior/v2026_02_01.bhuild-speed/3.3.blueprint.v1.i1.md`

### verification
- [ ] `npm run build` passes
- [ ] `npm run test:types` passes
- [ ] `npm run test:acceptance:locally` passes (baseline)

---

## phase 1: create brief

### prereqs
- [ ] phase 0 complete

### tasks
- [ ] create `.agent/repo=.this/role=any/briefs/howto.fast-skill-invocation.[lesson].md`
  - document the fast invocation pattern
  - include shell wrapper template
  - include index.ts cli namespace pattern
  - include contract/cli/ structure

### acceptance criteria
- [ ] brief exists at expected path
- [ ] brief contains shell wrapper example: `exec node -e "import('pkg').then(m => m.cli.X())" -- "$@"`
- [ ] brief contains cli namespace export pattern

### verification
- [ ] `cat .agent/repo=.this/role=any/briefs/howto.fast-skill-invocation.[lesson].md` shows content

---

## phase 2: create cli wrappers

### prereqs
- [ ] phase 1 complete

### tasks
- [ ] create `src/contract/cli/review.ts`
  - move logic from `src/domain.roles/reviewer/skills/review.cli.ts`
  - export `review` function
  - retain arg parse logic, brain load, stepReview invocation

- [ ] create `src/contract/cli/reflect.ts`
  - export `reflect` function
  - parse cli args (--source, --target, --mode, --force, --brain)
  - load brain atoms/repls
  - invoke stepReflect

### acceptance criteria
- [ ] `src/contract/cli/review.ts` exists and exports `review`
- [ ] `src/contract/cli/reflect.ts` exists and exports `reflect`
- [ ] both functions have `.what` and `.why` jsdoc comments

### verification
- [ ] `npm run test:types` passes
- [ ] `grep -l "export const review" src/contract/cli/review.ts` succeeds
- [ ] `grep -l "export const reflect" src/contract/cli/reflect.ts` succeeds

---

## phase 3: update index.ts exports

### prereqs
- [ ] phase 2 complete

### tasks
- [ ] update `src/index.ts` to import cli functions
- [ ] export `cli` namespace object with review and reflect

### acceptance criteria
- [ ] `src/index.ts` contains `export const cli = { review, reflect }`
- [ ] cli functions imported from `@src/contract/cli/*`

### verification
- [ ] `npm run build` passes
- [ ] `npm run test:types` passes
- [ ] `node -e "import('rhachet-roles-bhrain').then(m => console.log(Object.keys(m.cli)))"` outputs `[ 'review', 'reflect' ]`

---

## phase 4: update shell scripts

### prereqs
- [ ] phase 3 complete
- [ ] `npm run build` passes (dist/ must contain cli exports)

### tasks
- [ ] update `src/domain.roles/reviewer/skills/review.sh`
  - remove `SCRIPT_DIR` resolution
  - change to `exec node -e "import('rhachet-roles-bhrain').then(m => m.cli.review())" -- "$@"`

- [ ] update `src/domain.roles/reviewer/skills/reflect.sh`
  - change `npx tsx -e` to `node -e`
  - use `exec node -e "import('rhachet-roles-bhrain').then(m => m.cli.reflect())" -- "$@"`

### acceptance criteria
- [ ] `review.sh` contains `import('rhachet-roles-bhrain')`
- [ ] `review.sh` does NOT contain `SCRIPT_DIR`
- [ ] `reflect.sh` contains `node -e` (not `npx tsx -e`)
- [ ] `reflect.sh` contains `import('rhachet-roles-bhrain')`

### verification
- [ ] `npm run build` passes
- [ ] `grep "SCRIPT_DIR" src/domain.roles/reviewer/skills/review.sh` returns empty
- [ ] `grep "npx tsx" src/domain.roles/reviewer/skills/reflect.sh` returns empty

---

## phase 5: cleanup old files

### prereqs
- [ ] phase 4 complete

### tasks
- [ ] delete `src/domain.roles/reviewer/skills/review.cli.ts`

### acceptance criteria
- [ ] `src/domain.roles/reviewer/skills/review.cli.ts` does not exist

### verification
- [ ] `npm run build` passes
- [ ] `npm run test:types` passes
- [ ] `ls src/domain.roles/reviewer/skills/review.cli.ts` returns "no such file"

---

## phase 6: acceptance verification

### prereqs
- [ ] phase 5 complete

### tasks
- [ ] run full acceptance test suite
- [ ] verify skill invocation speed improvement

### acceptance criteria
- [ ] all acceptance tests pass
- [ ] `review.sh --help` completes in <500ms
- [ ] `reflect.sh --help` completes in <500ms (was ~1500ms with tsx)

### verification
- [ ] `npm run build` passes
- [ ] `npm run test:acceptance:locally` passes
- [ ] `time bash dist/domain.roles/reviewer/skills/review.sh --help` shows real < 0.5s

---

## phase 7: final validation

### prereqs
- [ ] phase 6 complete

### tasks
- [ ] run full test suite
- [ ] verify no regressions

### acceptance criteria
- [ ] all tests pass
- [ ] shell scripts accept same args as before
- [ ] sdk exports unchanged (stepReview, stepReflect still exported)

### verification
- [ ] `npm run test` passes (full suite)
- [ ] `node -e "import('rhachet-roles-bhrain').then(m => console.log(typeof m.stepReview, typeof m.stepReflect))"` outputs `function function`

---

## summary checklist

| phase | description | depends on |
|-------|-------------|------------|
| 0 | preparation | - |
| 1 | create brief | phase 0 |
| 2 | create cli wrappers | phase 1 |
| 3 | update index.ts | phase 2 |
| 4 | update shell scripts | phase 3 |
| 5 | cleanup old files | phase 4 |
| 6 | acceptance verification | phase 5 |
| 7 | final validation | phase 6 |
