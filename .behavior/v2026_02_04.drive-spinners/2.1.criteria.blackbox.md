# blackbox criteria: drive-spinners

## usecase.1 = guard progress tree in stdout

the final stdout emit from `route.stone.set` must include the full guard tree with results for each review and judge.

```
given('a guarded stone with reviews and judges')
  when('setStoneAsPassed completes with passage allowed')
    then('stdout contains guard section with artifacts, reviews, and judges')
      sothat('the human sees the full guard result in one structured tree')
    then('each review shows âœ“ finished {duration}s')
    then('each review shows blocker count with ðŸ”´ when blockers > 0')
    then('each review shows nitpick count with ðŸŸ  when nitpicks > 0')
    then('each review omits blocker/nitpick lines when counts are 0')
    then('each review shows path to review artifact under .route/')
    then('each judge shows âœ“ finished {duration}s')
    then('each judge shows passed status')
    then('stdout contains passage = allowed')

  when('setStoneAsPassed completes with passage blocked')
    then('each failed judge shows âœ— finished {duration}s')
    then('each failed judge shows reason for failure')
    then('stdout contains passage = blocked')
    then('stdout contains reason = {combined failure reasons}')

given('a guarded stone with cached reviews')
  when('setStoneAsPassed completes and some reviews hit cache')
    then('cached reviews show Â· cached instead of finished {duration}s')
      sothat('the human knows prior work was reused')
    then('fresh reviews show âœ“ finished {duration}s')
      sothat('the human sees which reviews ran fresh')

given('a guarded stone with cached judges')
  when('setStoneAsPassed completes and some judges hit cache')
    then('cached judges show Â· cached instead of finished {duration}s')
    then('fresh judges show âœ“ or âœ— finished {duration}s')

given('an unguarded stone')
  when('setStoneAsPassed completes')
    then('stdout omits guard section')
    then('stdout shows passage = allowed (unguarded)')
      sothat('the tree stays minimal when no guard exists')

given('a guard with artifacts only (no reviews, no judges)')
  when('setStoneAsPassed completes')
    then('stdout shows artifacts section')
    then('stdout omits reviews and judges sections')
    then('stdout shows passage = allowed (artifacts only)')
```

## usecase.2 = guard progress tree in stderr (live)

while reviews and judges execute, stderr must show a live progress tree.

```
given('a guarded stone with reviews and judges')
  when('a review starts')
    then('stderr shows the review with inflight {elapsed}s â ¹')
      sothat('the human sees which review is active and how long it has run')
    then('queued reviews show Â· queued')
    then('queued judges show Â· queued')

  when('a review finishes')
    then('stderr updates that review to show âœ“ finished {duration}s')
    then('stderr updates that review to show blocker and nitpick counts')

  when('all reviews finish and a judge starts')
    then('stderr shows the judge with inflight {elapsed}s â ¹')
    then('queued judges show Â· queued')

  when('a judge finishes')
    then('stderr updates that judge to show âœ“ or âœ— finished {duration}s')

  when('all reviews and judges finish')
    then('stderr tree shows final state (no active spinners)')

given('a guarded stone where all reviews and judges are cached')
  when('setStoneAsPassed runs')
    then('stderr shows all reviews as Â· cached')
    then('stderr shows all judges as Â· cached')
      sothat('the human sees instant resolution with no wait')
```

## usecase.3 = artifact enumeration in guard tree

the guard tree must list all matched artifacts.

```
given('a guarded stone with multiple artifacts')
  when('setStoneAsPassed runs')
    then('stdout guard tree lists each artifact filename under artifacts section')
      sothat('the human sees exactly which files were evaluated')

given('a guarded stone with one artifact')
  when('setStoneAsPassed runs')
    then('stdout guard tree lists the single artifact filename')
```

## usecase.4 = review and judge index labels

each review and judge must show its index and command label.

```
given('a guard with 2 reviews and 2 judges')
  when('setStoneAsPassed runs')
    then('reviews are labeled r1, r2')
    then('judges are labeled j1, j2')
    then('each label is followed by a command identifier')
      sothat('the human can map results to the guard commands that produced them')
```
