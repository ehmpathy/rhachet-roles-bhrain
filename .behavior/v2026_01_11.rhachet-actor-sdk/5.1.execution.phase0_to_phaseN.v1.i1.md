# execution: brain choice for review and reflect skills

progress tracker for roadmap execution.

---

## phase.0 = foundation: genContextBrainChoice

### step.0.1 = install rhachet brain dependencies

**status:** ‚úÖ complete

**verification:**
- `rhachet-brains-anthropic`: 0.1.3 ‚úÖ
- `rhachet-brains-openai`: 0.1.9 ‚úÖ
- `rhachet-brains-xai`: 0.1.3 ‚úÖ
- `npm run test:types` passes ‚úÖ

**notes:**
- packages export `getBrainAtomsByXAI()`, `getBrainAtomsByAnthropic()`, `getBrainAtomsByOpenAI()`
- each returns `BrainAtom[]` for registration with `genContextBrain`

---

### step.0.2 = create genContextBrainChoice function

**status:** üîÑ in progress

**checklist:**
- [ ] create `src/_topublish/rhachet/genContextBrainChoice.ts`
- [ ] implement brain ref parse (`{provider}/{family}/{model}`)
- [ ] implement brain lookup from `context.brain` registry
- [ ] implement api key validation for provider
- [ ] implement `BadRequestError` on invalid brain ref (shows available brains)
- [ ] implement `BadRequestError` on absent api key (shows env var name)

---

### step.0.3 = unit tests for genContextBrainChoice

**status:** ‚è≥ queued

---

### step.0.4 = integration tests for genContextBrainChoice

**status:** ‚è≥ queued

---

## phase.1 = cli brain flag

### step.1.1 = add brain arg to review cli schema

**status:** ‚è≥ queued

---

### step.1.2 = add brain arg to reflect cli schema

**status:** ‚è≥ queued

---

### step.1.3 = implement brain help output

**status:** ‚è≥ queued

---

## phase.2 = stepReview with brain choice

### step.2.1 = add brain input to stepReview

**status:** ‚è≥ queued

---

### step.2.2 = replace invokeClaudeCode with brain.choice.ask

**status:** ‚è≥ queued

---

### step.2.3 = integration tests for stepReview brain choice

**status:** ‚è≥ queued

---

### step.2.4 = wire review cli to stepReview brain arg

**status:** ‚è≥ queued

---

### step.2.5 = deprecate invokeClaudeCode

**status:** ‚è≥ queued

---

## phase.3 = stepReflect with brain choice

### step.3.1 = add brain input to stepReflect

**status:** ‚è≥ queued

---

### step.3.2 = replace invokeClaudeCodeForReflect with brain.choice.act

**status:** ‚è≥ queued

---

### step.3.3 = remove rapid flag from compileReflectStep2Prompt

**status:** ‚è≥ queued

---

### step.3.4 = integration tests for stepReflect brain choice

**status:** ‚è≥ queued

---

### step.3.5 = migrate haiku test to grok test

**status:** ‚è≥ queued

---

### step.3.6 = migrate sonnet test to brain arg

**status:** ‚è≥ queued

---

### step.3.7 = wire reflect cli to stepReflect brain arg

**status:** ‚è≥ queued

---

### step.3.8 = deprecate invokeClaudeCodeForReflect

**status:** ‚è≥ queued

---

## phase.4 = cleanup

### step.4.1 = comment out price rate logic in reflect metrics

**status:** ‚è≥ queued

---

### step.4.2 = comment out price rate logic in stepReview

**status:** ‚è≥ queued

---

### step.4.3 = comment out usage extraction logic

**status:** ‚è≥ queued

---

### step.4.4 = remove rapid flag from reflect cli

**status:** ‚è≥ queued

---

## phase.5 = validation

### step.5.1 = verify stepReview backward compatibility

**status:** ‚è≥ queued

---

### step.5.2 = verify stepReflect backward compatibility

**status:** ‚è≥ queued

---

### step.5.3 = verify cli backward compatibility

**status:** ‚è≥ queued

---

### step.5.4 = run full test suite

**status:** ‚è≥ queued

---

## summary

| phase | steps | complete |
|-------|-------|----------|
| phase.0 | 4 | 1/4 |
| phase.1 | 3 | 0/3 |
| phase.2 | 5 | 0/5 |
| phase.3 | 8 | 0/8 |
| phase.4 | 4 | 0/4 |
| phase.5 | 4 | 0/4 |
| **total** | **28** | **1/28** |
