# feedback response checklist

## blockers

- [x] blocker.1: Keep BrainArch1 types as instantiable domain objects (functions within domain objects are supported)
- [x] blocker.2: Make BrainArch1Atom a plugin with `.generate()` method so generateBrainArch1LlmResponse can just call `atom.generate()`
- [x] blocker.3: Rename BrainArch1Config -> BrainArch1Actor with proper documentation about actor vs agent distinction
- [x] blocker.4: Group maxIterations/maxTokens under `constraints` object
- [x] blocker.5: Group systemPrompt under `role` object
- [x] blocker.6: Rename memoryManager -> memory, permissionGuard -> permission
- [x] blocker.7: Remove fallback in toJsonSchema - require object schemas only

## execution plan

1. Read current BrainArch1 domain objects to understand structure
2. Update BrainArch1Atom to be a plugin with `.generate()` method
3. Rename BrainArch1Config to BrainArch1Actor with restructured properties
4. Update all consumers of these types
5. Remove toJsonSchema fallback
6. Run type check and fix issues
7. Run tests to verify

## checkoffs

### blocker.1: domain objects with function support
- `BrainArch1Actor` interface supports function properties (e.g., `atom.generate()`, `memory`, `permission`)
- documented in type definition: `.note = this contains interfaces with functions, so it's not fully serializable. functions within domain objects are well supported.`

### blocker.2: atom plugin with `.generate()` method
- `BrainArch1Atom` is now an interface with `name`, `description`, and `generate()` method
- `generateBrainArch1LlmResponse` now simply calls `input.atom.generate()` and returns the result
- created atom plugin implementations:
  - `atomAnthropic({ model })` - anthropic provider
  - `atomOpenai({ model })` - openai provider
  - `atomQwen({ model })` - qwen provider

### blocker.3: renamed config to actor with docs
- renamed `BrainArch1Config` -> `BrainArch1Actor` with deprecation alias
- added documentation explaining actor vs agent distinction:
  > .note = the difference between actor & agent is that agency is granted only after
  > a real user delegates responsibilities to the actor. so we can't say it's
  > an agent here yet (since it could be readonly with no delegated responsibilities).
  > but we know for sure it's an actor.

### blocker.4: constraints object
- grouped `maxIterations` and `maxTokens` under `constraints` object:
  ```typescript
  constraints: {
    maxIterations: number;
    maxTokens: number;
  };
  ```

### blocker.5: role object
- grouped `systemPrompt` under `role` object:
  ```typescript
  role: {
    systemPrompt: string | null;
  };
  ```

### blocker.6: renamed plugin properties
- renamed `memoryManager` -> `memory`
- renamed `permissionGuard` -> `permission`

### blocker.7: removed toJsonSchema fallback
- `toJsonSchema()` now throws an error for non-object schemas instead of returning empty fallback
- error message: `'toJsonSchema requires a zod object schema. Tool parameters must be objects.'`

### files changed
- `src/domain.objects/BrainArch1/BrainArch1Atom.ts` - converted to plugin interface
- `src/domain.objects/BrainArch1/BrainArch1Config.ts` - renamed to BrainArch1Actor with new structure
- `src/domain.objects/BrainArch1/BrainArch1ToolDefinition.ts` - removed toJsonSchema fallback
- `src/domain.operations/brain.replic.arch1/llm/generateBrainArch1LlmResponse.ts` - simplified to delegate to atom.generate()
- `src/domain.operations/brain.replic.arch1/plugins/atoms/` - new atom plugin implementations
- `src/domain.operations/brain.replic.arch1/core/invokeBrainArch1.ts` - updated to use new Actor structure
- `src/roles/brain/skills/act/skillAct.ts` - updated to use atom plugins
- `src/roles/brain/skills/act/stepAct.ts` - updated to use new Actor structure
- all test files updated to use new patterns

### verification
- type check passes: `npm run test:types` succeeds with no errors
