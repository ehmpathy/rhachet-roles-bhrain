# research: templates for init.research

## summary

the init.behavior skill from rhachet-roles-bhuild provides the template patterns for init.research. the key patterns are:

1. **domain operation** — `initBehaviorDir.ts` creates directories and findserts template files
2. **template files** — `.stone` for instructions, `.guard` for approval gates, `.md` for artifacts
3. **branch bind** — `.bind/` directory with flag files that associate branches to behaviors
4. **variable substitution** — `$BEHAVIOR_DIR_REL` replaced at template write time

---

## lesson.1 = domain operation pattern

### initBehaviorDir.ts

**[TEMPLATE]** the domain operation creates the behavior directory and findserts all template files [1]

> "creates behavior directory if not found, findserts all template files (creates if not found, skips if exists), replaces $BEHAVIOR_DIR_REL in template content, idempotent: safe to rerun"

```typescript
export const initBehaviorDir = (input: {
  behaviorDir: string;
  behaviorDirRel: string;
}): { created: string[]; kept: string[] } => {
  const created: string[] = [];
  const kept: string[] = [];

  // create behavior directory (idempotent)
  mkdirSync(input.behaviorDir, { recursive: true });

  // read all template files
  const templateFiles = readdirSync(TEMPLATES_DIR);

  for (const templateName of templateFiles) {
    const templatePath = join(TEMPLATES_DIR, templateName);
    const targetPath = join(input.behaviorDir, templateName);

    // findsert: skip if exists
    if (existsSync(targetPath)) {
      kept.push(templateName);
      continue;
    }

    // read template and replace variable
    let content = readFileSync(templatePath, 'utf-8');
    content = content.replace(/\$BEHAVIOR_DIR_REL/g, input.behaviorDirRel);

    // write template file
    writeFileSync(targetPath, content);
    created.push(templateName);
  }

  return { created, kept };
};
```

**key pattern**: findsert semantics — create if not found, skip if found. returns `{ created, kept }` for output tree render.

---

## lesson.2 = template file types

### file extensions

**[TEMPLATE]** the behavior thoughtroute uses three file types [2]

| extension | purpose | example |
|-----------|---------|---------|
| `.stone` | instruction file for a thoughtroute step | `1.vision.stone` |
| `.guard` | approval gate that requires human confirmation | `1.vision.guard` |
| `.md` | artifact produced by the thoughtroute | `1.vision.md` |

### template files in init.behavior

**[TEMPLATE]** the init.behavior skill creates these template files [2]

```
.ref.[feedback].v1.[given].by_human.md
0.wish.md
1.vision.guard
1.vision.stone
2.1.criteria.blackbox.stone
2.2.criteria.blackbox.matrix.stone
2.3.criteria.blueprint.stone
3.1.research.access._.v1.stone
3.1.research.claims._.v1.stone
3.1.research.domain._.v1.stone
3.1.research.domain.terms.v1.stone
3.1.research.patterns._.code.prod.v1.stone
3.1.research.patterns._.code.test.v1.stone
3.1.research.patterns._.oss.levers.v1.stone
3.1.research.references._.v1.stone
3.1.research.templates._.v1.stone
3.2.distill.domain._.v1.stone
3.3.blueprint.v1.guard
3.3.blueprint.v1.stone
4.1.roadmap.v1.stone
5.1.execution.phase0_to_phaseN.v1.stone
```

---

## lesson.3 = template content patterns

### 0.wish.md template

**[TEMPLATE]** the wish template is minimal — just a placeholder for the research question [3]

> `wish =`

### 1.vision.stone template

**[TEMPLATE]** the vision stone guides illustration of the outcome world [4]

> "paint a picture of what the world looks like when this wish is fulfilled"

key sections:
- **the outcome world** — day-in-the-life, before/after contrast, "aha" moment
- **user experience** — usecases, goals, contract inputs/outputs, timelines
- **mental model** — how users describe it, analogies, terminology
- **evaluation** — how well it solves goals, pros/cons, edgecases

### 2.1.criteria.blackbox.stone template

**[TEMPLATE]** the blackbox criteria stone uses BDD declarations [5]

> "blackbox criteria = experience boundaries (no implementation details)"

key sections:
- **episode experience** — workflows, critical paths, edge cases
- **exchange experience** — inputs, outputs, errors, boundary conditions

template format:
```
given()
  when()
    then()
      sothat()
```

### 3.1.research.claims._.v1.stone template

**[TEMPLATE]** the claims stone requires citation of every claim with exact quotes [6]

> "cite every claim, number each citation, clone exact quotes from each citation"

claim labels:
- `[FACT]` = indisputable, immutable truth
- `[SUMP]` = assumption made explicitly or implicitly
- `[KHUE]` = open question to consider
- `[OPIN]` = subjective declaration to consider

### 3.2.distill.domain._.v1.stone template

**[TEMPLATE]** the distill stone asks for domain objects and operations [7]

> "declare the domain.objects, domain.operations, and access.daos that would fulfill this, via the declastruct pattern"

key sections:
- **domain objects** — entities, events, literals
- **domain operations** — getOne, getAll, setCreate, setUpdate, setDelete
- **relationships** — treestruct of decoration, common subdomains, dependencies

---

## lesson.4 = branch bind pattern

### setBranchBehaviorBind.ts

**[TEMPLATE]** the bind operation creates a flag file in `.bind/` [8]

> "bind a branch to a behavior, creates the bind flag file that associates a branch with a behavior"

key patterns:
- rejects main/master branches
- creates `.bind/` directory with flag file
- flag file contains branch name and bound_by metadata
- idempotent: returns already_bound if same behavior

```typescript
// create bind flag with metadata
const flagPath = join(bindDir, `${branchFlat}.flag`);
writeFileSync(
  flagPath,
  `branch: ${input.branchName}
bound_by: ${input.boundBy ?? 'bind.behavior skill'}
`,
);
```

---

## lesson.5 = variable substitution pattern

**[TEMPLATE]** templates use `$BEHAVIOR_DIR_REL` for relative path references [1]

> "replaces $BEHAVIOR_DIR_REL in template content"

this allows templates to reference other files in the behavior directory without hardcoded paths.

example from 1.vision.stone:
> "illustrate the vision implied in the wish $BEHAVIOR_DIR_REL/0.wish.md"

---

## map to init.research

| init.behavior pattern | init.research adaptation |
|----------------------|--------------------------|
| `.behavior/` directory | `.research/` directory |
| `.stone` instruction files | `.src` instruction files |
| `$BEHAVIOR_DIR_REL` variable | `$RESEARCH_DIR_REL` variable |
| `.bind/` with `.flag` files | `.bind/` with `.flag` files |
| vision/criteria/research stones | probes.aim/emit/absorb/remit/curate.src |

### proposed init.research template files

```
0.wish.md                    # research question/scope
1.probes.aim.src             # articulate 21+ questions, divergent paths
2.probes.emit.src            # dispatch parallel agents to investigate
3.probes.absorb.src          # synthesize into kernels, clusters, gaps
4.probes.remit.src           # fill gaps with supplemental probes
5.briefs.curate.src          # externalize to structured briefs
.bind/{user}.{name}.flag     # branch bind
```

---

## citations

| # | source | description |
|---|--------|-------------|
| 1 | initBehaviorDir.ts | domain operation for directory initialization |
| 2 | templates/ directory | list of template files |
| 3 | templates/0.wish.md | wish template content |
| 4 | templates/1.vision.stone | vision stone template content |
| 5 | templates/2.1.criteria.blackbox.stone | blackbox criteria template content |
| 6 | templates/3.1.research.claims._.v1.stone | claims research template content |
| 7 | templates/3.2.distill.domain._.v1.stone | domain distill template content |
| 8 | setBranchBehaviorBind.ts | branch bind operation |

all sources from: `ehmpathy/rhachet-roles-bhuild` branch `vlad/driver-bind`
