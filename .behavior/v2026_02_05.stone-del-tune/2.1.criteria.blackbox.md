
# blackbox criteria: route.stone.del tune

## usecase.1 = fuzzy pattern match

given('a route with stones named 3.1.research.access._.v1, 3.1.research.domain._.v1, 1.vision, 2.1.criteria')
  when('--stone research (no glob chars)')
    then('pattern auto-expands to *research*')
      sothat('users type natural words without glob syntax')
    then('matched stones include all stones with "research" in the name')
    then('matched stones exclude stones without "research" in the name')

  when('--stone "*.research.*" (explicit glob chars)')
    then('pattern is used as-is, no auto-wrap')
      sothat('explicit globs are respected for power users')

  when('--stone "*" (wildcard)')
    then('all stones in the route are matched')

  when('--stone nonexistent (no glob chars, no matches)')
    then('pattern auto-expands to *nonexistent*')
    then('output reports no stones matched')


## usecase.2 = plan mode (safe by default)

given('a route with 9 research stones, 7 without artifacts and 2 with artifacts')
  when('--stone research, no --mode flag')
    then('defaults to --mode plan')
      sothat('destructive operations are safe by default')
    then('stdout shows ðŸ¦‰ header with "hoo needs \'em"')
    then('stdout shows ðŸ—¿ treestruct with pattern, route, and stones branch')
    then('each stone in stones branch shows âœ“ (delete) or âŠ˜ (retain, artifact found)')
    then('summary shows delete = 7 and retain = 2')
    then('no files are removed from disk')
      sothat('plan mode is read-only')
    then('stdout hints to rerun with --mode apply')

  when('--stone research --mode plan')
    then('behaves identical to no --mode flag')
      sothat('explicit plan matches implicit default')


## usecase.3 = apply mode (destructive)

given('a route with 9 research stones, 7 without artifacts and 2 with artifacts')
  when('--stone research --mode apply')
    then('stdout shows ðŸ¦‰ header with "hoo needs \'em"')
    then('stdout shows ðŸ—¿ treestruct with pattern, route, and stones branch')
    then('each stone in stones branch shows âœ“ (deleted) or âŠ˜ (retained, artifact found)')
    then('summary shows deleted = 7 and retained = 2')
    then('the 7 stones without artifacts are removed from disk')
    then('the 2 stones with artifacts are preserved on disk')
      sothat('artifacts are never lost via stone deletion')


## usecase.4 = treestruct output format

given('a route with matched stones')
  when('plan or apply mode produces output')
    then('output follows the ðŸ¦‰ header + ðŸ—¿ treestruct pattern')
      sothat('output is symmetric with route.stone.get and route.stone.set')
    then('pattern and route are top-level branches of ðŸ—¿')
    then('stones is a nested branch that holds each matched stone')
    then('summary counts (delete/retain or deleted/retained) are top-level branches')


## usecase.5 = no stones matched

given('a route with stones that do not match the pattern')
  when('--stone nonexistent')
    then('output reports no stones matched pattern')
    then('no files are removed from disk')
    then('exit code is 0')
      sothat('empty match is not an error, just informational')


## usecase.6 = route not found

given('a path that does not point to a route directory')
  when('--stone research --route /nonexistent/path')
    then('exit code is non-zero')
    then('stderr reports route not found')

